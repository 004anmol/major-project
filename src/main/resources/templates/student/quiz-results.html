<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body th:replace="~{layout :: layout('Quiz Results', ~{::content})}">

<th:block th:fragment="content">

    <h2 class="mb-4"><i class="fas fa-chart-line"></i> Quiz Results</h2>

    <div th:if="${results != null and !results.isEmpty()}" class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>Quiz Title</th>
                <th>Score</th>
                <th>Total Questions</th>
                <th>Percentage</th>
                <th>Completed At</th>
                <th>Actions</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="result : ${results}">
                <td th:text="${result.quiz != null ? result.quiz.title : 'N/A'}"></td>
                <td>
                    <strong th:text="${result.score != null ? result.score : 0}"></strong>
                </td>
                <td th:text="${result.totalQuestions != null ? result.totalQuestions : 0}"></td>
                <td>
                    <th:block th:if="${result.totalQuestions != null and result.totalQuestions > 0}">
                        <th:block th:with="percentage=${result.score * 100.0 / result.totalQuestions}">
                            <span class="badge fs-6 px-3 py-2"
                                  th:classappend="${percentage >= 70} ? 'bg-success' : (${percentage >= 50} ? 'bg-warning text-dark' : 'bg-danger')">
                                <span th:text="${#numbers.formatDecimal(percentage, 1, 1)} + '%'"></span>
                            </span>
                        </th:block>
                    </th:block>
                    <th:block th:unless="${result.totalQuestions != null and result.totalQuestions > 0}">
                        <span class="badge bg-secondary">N/A</span>
                    </th:block>
                </td>
                <td>
                    <small th:text="${result.completedAt != null ? #temporals.format(result.completedAt, 'dd MMM yyyy HH:mm') : 'N/A'}"></small>
                </td>
                <td>
                    <a th:href="@{/student/quiz-result/{id}(id=${result.id})}" class="btn btn-sm btn-info text-white">
                        <i class="fas fa-eye"></i> View Details
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${results == null or results.isEmpty()}" class="alert alert-info">
        <i class="fas fa-info-circle"></i> No quiz results yet. Take a quiz to see your results here!
        <div class="mt-3">
            <a th:href="@{/student/quizzes}" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i> Go to Quizzes
            </a>
            <a th:href="@{/student/quiz/generate}" class="btn btn-success">
                <i class="fas fa-robot"></i> Generate AI Quiz
            </a>
        </div>
    </div>

    <!-- Pagination (if needed) -->
    <nav th:if="${results != null and results.size() > 0}" aria-label="Quiz results pagination" class="mt-4">
        <ul class="pagination justify-content-center">
            <!-- Add pagination controls here if you have multiple pages -->
        </ul>
    </nav>

</th:block>

</body>
</html>